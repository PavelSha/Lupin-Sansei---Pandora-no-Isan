# Предисловие

Некоторые участки кода будет описаны с помощью языка программирования JavaScript для более упрощенного понимаю с ссылками на дизассемблированный код в комментариях.
Под RegA будем понимать содержимое регистра A.

# Jump table реализации

Следующая функция реализует поведение, напоминающее switch в языке JavaScript:

```nasm
; ROM address - 0x01D0D1, bank FF - $D0C1
sub_D0C1_change_stack_pointer:
  ASL
  TAY
  INY
  INY
  PLA
  STA $0012
  PLA
  STA $0013
  LDA ($0012),Y
  PHA
  DEY
  LDA ($0012),Y
  PHA
  RTS
```

Теперь вызов вышеуказанной функции в таком виде:

```nasm
JSR sub_D0C1_change_stack_pointer

.addr loc_00 - 1
.addr loc_01 - 1
.addr loc_02 - 1
.addr loc_03 - 1
.addr loc_04 - 1
.addr loc_05 - 1
.addr loc_06 - 1
.addr loc_07 - 1
```

Будет выполнять очень похожий механизм на языке JavaScript:

```js
// RegA - значение регистра-аккумулятора (регистр А)
switch(RegA) {
  case 0:
    fn_loc_00();
    break;
  case 1:
    fn_loc_01();
    break;
  case 2:
    fn_loc_02();
    break;
  case 3:
    fn_loc_03();
    break;
  case 4:
    fn_loc_04();
    break;
  case 5:
    fn_loc_05();
    break;
  case 6:
    fn_loc_06();
    break;
  case 7:
    fn_loc_07();
    break;
}
```

# Генерация случайных чисел (RNG)

Следующая функция используется в качестве генератора случайны чисел.
По сути, это функция ***5 * seed + 19*** на множестве значений байта, где ``seed`` постоянно заменяется по предыдыщему вычисленному случайному числу.

```js
/**
 * Смотри: ROM address - 0x01D074, bank FF - $D064
 * @return {Number} Случайное число из множества {0, 1, 2, ..., 255 }
 */
let rngSeed;
function fn_D064_generate_rng()
{
   // LDA vEnemyRNGValue
   // STA $0012
   let _ = rngSeed;

   // ASL
   // ASL
   // CLC
   // $0012
   _ = 5 * _;

   // CLC
   // ADC #$13
   _ = _ + 0x13;

   // STA vEnemyRNGValue
   rngSeed = _ & 0xFF;

   // RTS
   return rngSeed;
}
```

# Таблица с порядком отображения спрайтов

Для избежания ограничения в отображении 8-ми тайлов в ряд спрайты с каждым кадром отображаются в разном порядке, что может вызывать "эффект мерцания" (flicker effect).
Смотри ROM address - 0x01CFEE, bank FF - $CFDE

|Индекс|Индекс|Индекс|Индекс|Индекс|Индекс|Индекс|Индекс|Индекс|Индекс|Индекс|Индекс|Индекс|Индекс|Индекс|Индекс|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10| 11| 12| 13| 14| 15|
| 9 | 10| 11| 12| 13| 14| 15| 2 | 3 | 4 | 5 | 6 | 7 | 8 | 1 | 0 |
| 15| 14| 13| 12| 11| 10| 0 | 1 | 9 | 8 | 7 | 6 | 5 | 4 | 3 | 2 |
| 1 | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 0 | 15| 14| 13| 12| 11| 10| 9 |
| 5 | 6 | 7 | 8 | 2 | 3 | 4 | 12| 13| 14| 0 | 1 | 15| 9 | 8 | 7 |
| 12| 13| 14| 15| 1 | 0 | 9 | 10| 11| 5 | 6 | 7 | 8 | 2 | 3 | 4 |
| 4 | 3 | 2 | 1 | 0 | 8 | 7 | 6 | 5 | 11| 10| 9 | 15| 14| 13| 12|
| 11| 10| 9 | 15| 14| 13| 12| 1 | 0 | 4 | 3 | 2 | 8 | 7 | 6 | 5 |
